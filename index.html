<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simulatore Piani di Pagamento â€“ Soluzione Tasse</title>
<style>
    .natale-banner {
  margin: 10px auto 16px;
  padding: 6px 10px;
  text-align: center;
  font-size: 13px;
  color: #fff;
  background: linear-gradient(90deg, #b11226, #d4af37);
  border-radius: 8px;
}
    body { font-family: Arial, sans-serif; background: #f7f9fc; margin: 0; padding: 20px; color: #031341; }
    .container { max-width: 480px; margin: auto; background: white; padding: 20px 26px; border-radius: 14px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.12); border-top: 6px solid #031341; }
    h1 { text-align: center; margin-top: 0; font-size: 22px; color: #031341; }
    label { font-weight: bold; margin-top: 15px; display: block; }
    select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-top: 6px; }
    .box { margin-top: 20px; background: #eef2fb; padding: 15px; border-radius: 10px; }
    .result-line { margin: 8px 0; font-size: 15px; }
    .rate-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .rate-table th, .rate-table td { border: 1px solid #ccc; padding: 6px 8px; text-align: center; font-size: 14px; }
    .rate-table th { background: #031341; color: white; }
</style>
</head>
<body>
<div class="container">
    <h1>Simulatore Piani di Pagamento</h1>
    <label>Prodotto</label>
    <select id="prodotto">
        <option value="">Seleziona prodotto</option>
    </select>
    <label>Piano di pagamento</label>
    <select id="piano">
        <option value="">Seleziona</option>
        <option value="unica">Unica soluzione</option>
        <option value="0-30">0 / 30</option>
        <option value="0-30-60">0 / 30 / 60</option>
        <option value="0-30-60-90">0 / 30 / 60 / 90</option>
        <option value="0-30-60-90-120">0 / 30 / 60 / 90 / 120</option>
        <option value="0-30-60-90-120-150">0 / 30 / 60 / 90 / 120 / 150</option>
        <option value="12">12 rate mensili</option>
    </select>
    <div id="output" class="box" style="display:none;"></div>
</div>
<script>
    const IVA = 0.22;
    const prodotti = [
        { code: "CU 3000", net: 3000, extra: 130 },
        { code: "CUE 4500", net: 4500, extra: 130 },
        { code: "TU 5000", net: 5000, extra: 280 },
        { code: "TUE 6500", net: 6500, extra: 280 },
        { code: "TU 7500", net: 7500, extra: 280 },
        { code: "TUE 9000", net: 9000, extra: 280 },
        { code: "TU 10000", net: 10000, extra: 280 },
        { code: "TUE 11500", net: 11500, extra: 280 },
        { code: "TU 14000", net: 14000, extra: 280 },
        { code: "TUE 15500", net: 15500, extra: 280 },
        { code: "TU 18000", net: 18000, extra: 280 },
        { code: "TUE 19500", net: 19500, extra: 280 }
    ];
    function euro(n) { return n.toLocaleString("it-IT",{style:"currency",currency:"EUR"}); }
    prodotti.forEach((p,i)=>{ let o=document.createElement("option"); o.value=i; o.innerText=p.code;
        document.getElementById("prodotto").appendChild(o); });
    document.getElementById("prodotto").addEventListener("change", calcola);
    document.getElementById("piano").addEventListener("change", calcola);
    function calcola(){
        const idx=document.getElementById("prodotto").value;
        const piano=document.getElementById("piano").value;
        const box=document.getElementById("output");
        if(!idx||!piano){ box.style.display="none"; return; }
        const p=prodotti[idx];
        const totaleLordo=(p.net+p.extra)*(1+IVA);
        let anticipo;
        if(p.code==="CU 3000" || p.code==="CUE 4500"){
            anticipo=(totaleLordo-130*1.22)*0.3 + (130*1.22);
        } else {
            anticipo=(totaleLordo-280*1.22)*0.3 + (280*1.22);
        }
        let scadenze=[];
        switch(piano){
            case "unica": scadenze=[0]; break;
            case "0-30": scadenze=[0,30]; break;
            case "0-30-60": scadenze=[0,30,60]; break;
            case "0-30-60-90": scadenze=[0,30,60,90]; break;
            case "0-30-60-90-120": scadenze=[0,30,60,90,120]; break;
            case "0-30-60-90-120-150": scadenze=[0,30,60,90,120,150]; break;
            case "12": scadenze=Array.from({length:12},(_,i)=>i*30); break;
        }
        let html = `
            <div class="result-line"><strong>Prodotto:</strong> ${p.code}</div>
            <div class="result-line"><strong>Totale contratto:</strong> ${euro(totaleLordo)}</div>
            <div class="result-line"><strong>Anticipo:</strong> ${euro(anticipo)}</div>`;
        if(scadenze.length===1){
            html += `<div class="result-line"><strong>Pagamento unico al giorno 0</strong></div>`;
        } else {
            const restante=totaleLordo-anticipo;
            const nRate=scadenze.length-1;
            const rata=restante/nRate;
            html+=`<table class="rate-table">
                    <tr><th>Rata</th><th>Giorni</th><th>Importo</th></tr>
                    <tr><td>1 (Anticipo)</td><td>0</td><td>${euro(anticipo)}</td></tr>`;
            scadenze.slice(1).forEach((g,i)=>{
                html+=`<tr><td>${i+2}</td><td>${g}</td><td>${euro(rata)}</td></tr>`;
            });
            html+=`</table>`;
        }
        box.innerHTML=html;
        box.style.display="block";
    }
    // ----------------------
// GENERATORE CODICE FISCALE (base)
// ----------------------
const mesiMap = {
  1:"A", 2:"B", 3:"C", 4:"D", 5:"E", 6:"H",
  7:"L", 8:"M", 9:"P", 10:"R", 11:"S", 12:"T"
};

function soloLettere(s) {
  return (s || "").toUpperCase().replace(/[^A-Z]/g, "");
}

function consonanti(s){ return soloLettere(s).replace(/[AEIOU]/g,""); }
function vocali(s){ return soloLettere(s).replace(/[^AEIOU]/g,""); }

function codiceCognome(c){
  const cons = consonanti(c);
  const voc = vocali(c);
  return (cons + voc + "XXX").slice(0,3);
}

function codiceNome(n){
  const cons = consonanti(n);
  const voc = vocali(n);
  if(cons.length >= 4){
    return (cons[0] + cons[2] + cons[3]);
  }
  return (cons + voc + "XXX").slice(0,3);
}

function codiceDataSesso(dateStr, sesso){
  const d = new Date(dateStr);
  if(isNaN(d)) return null;
  const anno = String(d.getFullYear()).slice(-2);
  const mese = mesiMap[d.getMonth()+1];
  let giorno = d.getDate();
  if(sesso === "F") giorno += 40;
  const gg = String(giorno).padStart(2,"0");
  return anno + mese + gg;
}

// Tabelle per carattere di controllo
const pari = {
  "0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,
  "A":0,"B":1,"C":2,"D":3,"E":4,"F":5,"G":6,"H":7,"I":8,"J":9,
  "K":10,"L":11,"M":12,"N":13,"O":14,"P":15,"Q":16,"R":17,"S":18,"T":19,
  "U":20,"V":21,"W":22,"X":23,"Y":24,"Z":25
};
const dispari = {
  "0":1,"1":0,"2":5,"3":7,"4":9,"5":13,"6":15,"7":17,"8":19,"9":21,
  "A":1,"B":0,"C":5,"D":7,"E":9,"F":13,"G":15,"H":17,"I":19,"J":21,
  "K":2,"L":4,"M":18,"N":20,"O":11,"P":3,"Q":6,"R":8,"S":12,"T":14,
  "U":16,"V":10,"W":22,"X":25,"Y":24,"Z":23
};
const controllo = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

function checkChar(cf15){
  let sum = 0;
  for(let i=0; i<15; i++){
    const ch = cf15[i];
    const pos = i+1; // posizioni 1..15
    sum += (pos % 2 === 0) ? pari[ch] : dispari[ch];
  }
  return controllo[sum % 26];
}

function generaCF(){
  const cognome = document.getElementById("cf_cognome").value;
  const nome = document.getElementById("cf_nome").value;
  const sesso = document.getElementById("cf_sesso").value;
  const data = document.getElementById("cf_data").value;
  const comune = (document.getElementById("cf_comune").value || "").toUpperCase().trim();

  const cCogn = codiceCognome(cognome);
  const cNome = codiceNome(nome);
  const cData = codiceDataSesso(data, sesso);

  if(!cognome || !nome || !data || comune.length !== 4){
    document.getElementById("cf_output").innerHTML =
      "<span style='color:#b11226; font-weight:bold;'>Compila tutti i campi (Comune = 4 caratteri, es. F205).</span>";
    return;
  }

  const base15 = (cCogn + cNome + cData + comune).toUpperCase();
  const cc = checkChar(base15);
  const cf = base15 + cc;

  document.getElementById("cf_output").innerHTML =
    "<strong>Codice Fiscale:</strong> <span style='font-family:monospace; font-size:18px;'>" + cf + "</span>";
}

// Bottone CF
document.getElementById("btn_cf").addEventListener("click", generaCF);


// ----------------------
// BOTTONE VERIFICA PEC (apre INI-PEC)
// ----------------------
document.getElementById("btn_pec").addEventListener("click", function(){
  const pec = (document.getElementById("pec_input").value || "").trim();
  if(!pec){
    alert("Inserisci una PEC da verificare.");
    return;
  }
  // Apriamo il sito INI-PEC in nuova scheda (non possiamo fare ricerca automatica da HTML statico)
  window.open(
    "https://www.inipec.gov.it/web/guest/cerca-pec?p_p_id=search_pec_SearchPecPortlet_INSTANCE_AXK2wimPmw44&p_p_lifecycle=0&p_p_state=normal&p_p_mode=view&_search_pec_SearchPecPortlet_INSTANCE_AXK2wimPmw44_tabSelected=companies",
    "_blank"
  );
});

</script>
</body>
</html>
